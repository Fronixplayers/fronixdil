<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FronixLearner - Master the Future</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- 1. GLOBAL VARIABLES & RESET --- */
        :root {
            --primary: #4318FF; --primary-dark: #2B0EAE; --accent: #FF7E5F;
            --dark: #1B2559; --light: #f8fafc; --gray: #A3AED0;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); --transition: all 0.3s ease;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Montserrat', sans-serif; scroll-behavior: smooth; }
        body { background-color: var(--light); color: var(--dark); overflow-x: hidden; }
        a { text-decoration: none; color: inherit; }
        
        /* --- NAVBAR --- */
        nav {
            display: flex; justify-content: space-between; align-items: center;
            padding: 1.2rem 5%; background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px); position: fixed; width: 100%; top: 0; z-index: 1000;
            box-shadow: 0 2px 20px rgba(0,0,0,0.05);
        }
        .logo { font-size: 1.5rem; font-weight: 800; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        .nav-links { display: flex; gap: 2rem; align-items: center; }
        .nav-links a { font-weight: 600; color: var(--dark); transition: var(--transition); position: relative; cursor: pointer; }
        .nav-links a:hover { color: var(--primary); }
        .hamburger { display: none; font-size: 1.5rem; cursor: pointer; color: var(--dark); }

        /* --- BUTTONS --- */
        .btn { padding: 0.8rem 2rem; border-radius: 50px; font-weight: 700; cursor: pointer; border: none; transition: var(--transition); display: inline-flex; align-items: center; gap: 10px; font-size: 0.9rem; }
        .btn-fill { background: var(--primary); color: white; box-shadow: 0 10px 20px rgba(67, 24, 255, 0.2); }
        .btn-fill:hover { background: var(--primary-dark); transform: translateY(-3px); box-shadow: 0 15px 25px rgba(67, 24, 255, 0.4); }
        .btn-outline { border: 2px solid var(--primary); color: var(--primary); background: transparent; }
        .btn-outline:hover { background: var(--primary); color: white; transform: translateY(-3px); }

        /* --- HERO --- */
        .hero {
            display: flex; align-items: center; justify-content: space-between;
            padding: 8rem 5% 4rem; min-height: 90vh;
            background: radial-gradient(circle at 10% 10%, #eff4ff 0%, #f8fafc 100%);
            position: relative;
        }
        .hero-text { flex: 1; max-width: 600px; animation: fadeIn 1s ease-out; z-index: 2; }
        .hero-text h1 { font-size: 3.5rem; line-height: 1.1; margin-bottom: 1.5rem; color: var(--dark); font-weight: 800; }
        .hero-text span { color: var(--primary); }
        .hero-p { font-size: 1.1rem; color: var(--gray); margin-bottom: 2rem; line-height: 1.6; font-weight: 500; }
        .hero-img { flex: 1; display: flex; justify-content: center; z-index: 1; }
        .hero-img img { width: 100%; max-width: 550px; animation: float 4s ease-in-out infinite; }

        /* --- SECTIONS --- */
        section { padding: 6rem 5%; }
        .section-header { text-align: center; margin-bottom: 3rem; }
        .section-header h2 { font-size: 2.5rem; color: var(--dark); margin-bottom: 1rem; font-weight: 700; }
        .section-header p { color: var(--gray); max-width: 600px; margin: 0 auto; }

        /* --- SEARCH & FILTER --- */
        .search-container { max-width: 600px; margin: 0 auto 20px; position: relative; }
        .search-input { width: 100%; padding: 15px 25px; padding-right: 50px; border-radius: 50px; border: 2px solid #e2e8f0; font-size: 1rem; outline: none; box-shadow: 0 5px 15px rgba(0,0,0,0.05); transition: 0.3s; }
        .search-input:focus { border-color: var(--primary); box-shadow: 0 10px 20px rgba(67, 24, 255, 0.1); }
        .search-icon { position: absolute; right: 20px; top: 18px; color: var(--primary); font-size: 1.2rem; }

        .category-pills { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-bottom: 40px; }
        .cat-pill { padding: 8px 20px; border-radius: 30px; border: 1px solid #e2e8f0; background: white; cursor: pointer; font-weight: 600; color: var(--gray); transition: 0.3s; }
        .cat-pill:hover, .cat-pill.active { background: var(--primary); color: white; border-color: var(--primary); transform: translateY(-2px); }

        /* --- COURSE CARDS --- */
        .course-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2.5rem; max-width: 1200px; margin: 0 auto; min-height: 200px; }
        .course-card { background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.05); transition: var(--transition); cursor: pointer; border: 1px solid #f0f0f0; display: flex; flex-direction: column; }
        .course-card:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .thumb-container { position: relative; height: 180px; overflow: hidden; }
        .course-img { width: 100%; height: 100%; object-fit: cover; }
        .course-content { padding: 1.5rem; flex: 1; display: flex; flex-direction: column; }
        .course-tag { background: #eef2ff; color: var(--primary); padding: 5px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; display: inline-block; margin-bottom: 10px; align-self: flex-start; }
        .course-title { font-size: 1.2rem; margin-bottom: 0.5rem; font-weight: 700; color: var(--dark); }
        .course-desc { color: var(--gray); font-size: 0.9rem; margin-bottom: 1.5rem; flex: 1; }

        /* --- TESTIMONIALS --- */
        .testimonial-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; max-width: 1200px; margin: 0 auto; }
        .testimonial-card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); position: relative; }
        .testimonial-card i { font-size: 2rem; color: var(--primary); opacity: 0.2; position: absolute; top: 20px; left: 20px; }
        .t-text { font-style: italic; color: var(--dark); margin-bottom: 20px; position: relative; z-index: 2; }
        .t-user { display: flex; align-items: center; gap: 15px; }
        .t-avatar { width: 50px; height: 50px; border-radius: 50%; background: #ddd; object-fit: cover; }

        /* --- FAQ --- */
        .faq-container { max-width: 800px; margin: 0 auto; }
        .faq-item { background: white; border-radius: 15px; margin-bottom: 15px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.03); }
        .faq-question { padding: 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: 700; color: var(--dark); transition: 0.3s; }
        .faq-question:hover { background: #f8fafc; }
        .faq-answer { padding: 0 20px; max-height: 0; overflow: hidden; transition: max-height 0.3s ease, padding 0.3s ease; color: var(--gray); line-height: 1.6; }
        .faq-item.active .faq-answer { padding: 0 20px 20px 20px; max-height: 200px; }
        .faq-item.active .faq-question { color: var(--primary); }
        .faq-icon { transition: 0.3s; }
        .faq-item.active .faq-icon { transform: rotate(180deg); }

        /* --- SCROLL TO TOP --- */
        .scroll-top { position: fixed; bottom: 30px; right: 30px; width: 50px; height: 50px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 10px 20px rgba(67, 24, 255, 0.3); opacity: 0; pointer-events: none; transition: 0.3s; z-index: 900; }
        .scroll-top.visible { opacity: 1; pointer-events: all; }
        .scroll-top:hover { transform: translateY(-5px); background: var(--primary-dark); }
        
        /* --- MODAL (Authentication) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(27, 37, 89, 0.4); backdrop-filter: blur(8px);
            z-index: 2000; display: none; justify-content: center; align-items: center;
            opacity: 0; transition: opacity 0.3s ease;
        }
        .modal-overlay.active { display: flex; opacity: 1; }
        
        .auth-container {
            width: 900px; max-width: 95%; height: 600px;
            background: white;
            border-radius: 30px; display: flex; overflow: hidden;
            box-shadow: 0 30px 60px rgba(0,0,0,0.2); position: relative;
        }
        .close-modal { position: absolute; top: 20px; right: 20px; font-size: 1.5rem; color: var(--gray); cursor: pointer; z-index: 10; }
        
        .auth-visual { flex: 1; background: linear-gradient(135deg, var(--primary), #2B0EAE); padding: 40px; display: flex; flex-direction: column; justify-content: center; color: white; position: relative; overflow: hidden; }
        .auth-visual::before { content: ''; position: absolute; width: 300px; height: 300px; background: var(--accent); border-radius: 50%; top: -100px; left: -100px; opacity: 0.3; filter: blur(50px); }
        
        .auth-form-side { flex: 1; padding: 40px; display: flex; flex-direction: column; justify-content: center; overflow-y: auto; }
        .toggle-box { background: #f4f7fe; border-radius: 12px; padding: 5px; display: flex; margin-bottom: 25px; flex-shrink: 0; }
        .toggle-btn { flex: 1; padding: 10px; text-align: center; border-radius: 8px; font-weight: 600; color: var(--gray); cursor: pointer; transition: 0.3s; }
        .toggle-btn.active { background: var(--primary); color: white; box-shadow: 0 4px 10px rgba(67, 24, 255, 0.2); }
        
        .input-group { position: relative; margin-bottom: 15px; }
        .custom-input { width: 100%; padding: 10px 10px; border: none; border-bottom: 2px solid #e2e8f0; outline: none; font-size: 0.95rem; color: var(--dark); font-weight: 600; transition: 0.3s; background: transparent; }
        .custom-input:focus { border-color: var(--primary); }
        
        .half-input-container { display: flex; gap: 15px; }
        .half-input-container .input-group { flex: 1; }

        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.4s ease forwards; }

        @media (max-width: 900px) { 
            .hero { flex-direction: column-reverse; text-align: center; padding-top: 7rem; }
            .nav-links { display: none; } 
            .hamburger { display: block; }
            .auth-container { flex-direction: column; height: 90vh; }
            .auth-visual { display: none; }
            .auth-form-side { padding: 30px; }
        }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-20px); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <nav>
        <div class="logo"><i class="fas fa-atom fa-spin"></i> FronixLearner</div>
        <div class="nav-links" id="navLinks">
            <a href="#home">Home</a>
            <a href="#about">About</a>
            <a href="#courses">Courses</a>
            <a href="#testimonials">Stories</a>
            <button onclick="window.openModal('login')" class="btn btn-fill" style="margin-left: 20px;">Log In</button>
        </div>
        <div class="hamburger" onclick="toggleMenu()"><i class="fas fa-bars"></i></div>
    </nav>

    <div class="scroll-top" onclick="window.scrollTo(0,0)"><i class="fas fa-arrow-up"></i></div>

    <section class="hero" id="home">
        <div class="hero-text">
            <h1>Master the Future with <br><span>FronixLearner</span></h1>
            <p class="hero-p">Join the next generation of learners. Access premium YouTube-curated courses, expert mentorship, and real-world projects designed to launch your career.</p>
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <button onclick="window.openModal('signup')" class="btn btn-fill">Start Learning Now <i class="fas fa-arrow-right"></i></button>
                <a href="#courses" class="btn btn-outline"><i class="fas fa-play"></i> Explore Courses</a>
            </div>
        </div>
        <div class="hero-img">
            <img src="https://img.freepik.com/free-vector/online-learning-isometric-concept_1284-17947.jpg?w=740" alt="Learning Illustration">
        </div>
    </section>

    <section id="about" style="background: white;">
        <div class="section-header">
            <h2>Why Choose Fronix?</h2>
            <p>We simplify learning by curating the best free content into structured paths.</p>
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; max-width: 1200px; margin: 0 auto;">
            <div style="text-align: center; padding: 30px; background: #f8fafc; border-radius: 20px;">
                <i class="fas fa-laptop-code" style="font-size: 3rem; color: var(--primary); margin-bottom: 20px;"></i>
                <h3 style="margin-bottom: 10px;">Practical Skills</h3>
                <p style="color: var(--gray);">Learn by doing with real-world projects and examples.</p>
            </div>
            <div style="text-align: center; padding: 30px; background: #f8fafc; border-radius: 20px;">
                <i class="fas fa-users" style="font-size: 3rem; color: var(--accent); margin-bottom: 20px;"></i>
                <h3 style="margin-bottom: 10px;">Community</h3>
                <p style="color: var(--gray);">Join thousands of other students on the same journey.</p>
            </div>
            <div style="text-align: center; padding: 30px; background: #f8fafc; border-radius: 20px;">
                <i class="fas fa-certificate" style="font-size: 3rem; color: #10b981; margin-bottom: 20px;"></i>
                <h3 style="margin-bottom: 10px;">Certification</h3>
                <p style="color: var(--gray);">Earn certificates upon completion of your learning tracks.</p>
            </div>
        </div>
    </section>

    <section id="courses">
        <div class="section-header">
            <h2>Featured Courses</h2>
            <p>Explore our library of free courses. Search by topic or category.</p>
        </div>

        <div class="search-container">
            <input type="text" id="searchInput" class="search-input" onkeyup="window.filterCourses()" placeholder="Search courses (e.g. Python, React, Design)...">
            <i class="fas fa-search search-icon"></i>
        </div>

        <div class="category-pills">
            <div class="cat-pill active" onclick="window.filterCategory('all', this)">All</div>
            <div class="cat-pill" onclick="window.filterCategory('web', this)">Web Development</div>
            <div class="cat-pill" onclick="window.filterCategory('data', this)">Data Science</div>
            <div class="cat-pill" onclick="window.filterCategory('design', this)">Design</div>
            <div class="cat-pill" onclick="window.filterCategory('marketing', this)">Marketing</div>
        </div>

        <div class="course-grid" id="courseGrid">
            <p style="grid-column: 1/-1; text-align: center; color: var(--gray);">Loading courses from database...</p>
        </div>
    </section>

    <section id="testimonials" style="background: white;">
        <div class="section-header">
            <h2>Success Stories</h2>
            <p>Hear from students who transformed their careers with Fronix.</p>
        </div>
        <div class="testimonial-grid">
            <div class="testimonial-card">
                <i class="fas fa-quote-left"></i>
                <p class="t-text">"The structured approach to free content changed everything. I went from tutorial hell to landing my first job in 3 months."</p>
                <div class="t-user">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" class="t-avatar">
                    <div>
                        <strong>Alex Johnson</strong><br>
                        <span style="font-size:0.8rem; color:var(--gray);">Frontend Developer</span>
                    </div>
                </div>
            </div>
            <div class="testimonial-card">
                <i class="fas fa-quote-left"></i>
                <p class="t-text">"I loved the assignment system. Getting real feedback and even earning a small amount for projects was super motivating."</p>
                <div class="t-user">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka" class="t-avatar">
                    <div>
                        <strong>Sarah Williams</strong><br>
                        <span style="font-size:0.8rem; color:var(--gray);">UX Designer</span>
                    </div>
                </div>
            </div>
            <div class="testimonial-card">
                <i class="fas fa-quote-left"></i>
                <p class="t-text">"The admin team is very responsive. The college ID verification was quick, and accessing premium resources was seamless."</p>
                <div class="t-user">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Bubba" class="t-avatar">
                    <div>
                        <strong>Rahul Gupta</strong><br>
                        <span style="font-size:0.8rem; color:var(--gray);">CS Student</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="faq" style="background: #f8fafc;">
        <div class="section-header">
            <h2>Frequently Asked Questions</h2>
            <p>Got questions? We have answers.</p>
        </div>
        <div class="faq-container">
            <div class="faq-item" onclick="this.classList.toggle('active')">
                <div class="faq-question">
                    Is FronixLearner really free?
                    <i class="fas fa-chevron-down faq-icon"></i>
                </div>
                <div class="faq-answer">Yes! Our core mission is to curate the best free educational content from the web. We do offer premium features like certification and project review for a small fee (or XP), but learning is free.</div>
            </div>
            <div class="faq-item" onclick="this.classList.toggle('active')">
                <div class="faq-question">
                    How does the Assignment Marketplace work?
                    <i class="fas fa-chevron-down faq-icon"></i>
                </div>
                <div class="faq-answer">Students can browse real-world mini-projects posted by clients or admins. Completing these projects allows you to earn money or XP, which is held in escrow until approved.</div>
            </div>
            <div class="faq-item" onclick="this.classList.toggle('active')">
                <div class="faq-question">
                    Do I get a certificate?
                    <i class="fas fa-chevron-down faq-icon"></i>
                </div>
                <div class="faq-answer">Yes, upon completing a playlist and the associated quiz or project, a digital certificate is added to your profile which you can share on LinkedIn.</div>
            </div>
        </div>
    </section>

    <footer style="background: var(--dark); color: white; padding: 4rem 5%;">
        <div style="display:flex; flex-wrap:wrap; gap:40px; justify-content:space-between; max-width:1200px; margin:0 auto;">
            <div style="flex:1; min-width:250px;">
                <div class="logo" style="color:white; margin-bottom:15px;"><i class="fas fa-atom"></i> FronixLearner</div>
                <p style="color:#a3aed0; line-height:1.6;">Empowering students with accessible education and real-world opportunities. Built for the future, built for you.</p>
            </div>
            <div>
                <h4 style="margin-bottom:20px;">Platform</h4>
                <div style="display:flex; flex-direction:column; gap:10px; color:#a3aed0;">
                    <a href="#home">Home</a>
                    <a href="#courses">Courses</a>
                    <a href="#testimonials">Success Stories</a>
                    <a href="#" onclick="window.openModal('login')">Login / Signup</a>
                </div>
            </div>
            <div>
                <h4 style="margin-bottom:20px;">Contact</h4>
                <div style="display:flex; flex-direction:column; gap:10px; color:#a3aed0;">
                    <span><i class="fas fa-envelope"></i> support@fronix.com</span>
                    <span><i class="fas fa-phone"></i> +1 234 567 890</span>
                    <span><i class="fas fa-map-marker-alt"></i> New York, USA</span>
                </div>
            </div>
        </div>
        <div style="text-align:center; margin-top:50px; padding-top:20px; border-top:1px solid #333; color:#666;">
            &copy; 2024 FronixLearner. All rights reserved.
        </div>
    </footer>

    <div class="modal-overlay" id="authModal">
        <div class="auth-container">
            <span class="close-modal" onclick="window.closeModal()">&times;</span>
            
            <div class="auth-visual">
                <h1>Welcome Back!</h1>
                <p>Login to access your dashboard, track progress, and continue learning.</p>
            </div>

            <div class="auth-form-side">
                <div class="toggle-box">
                    <div class="toggle-btn active" onclick="window.switchMode('login')">Log In</div>
                    <div class="toggle-btn" onclick="window.switchMode('signup')">Sign Up</div>
                </div>

                <form id="authForm" onsubmit="window.handleAuth(event)" class="fade-in">
                    <h2 id="formTitle" style="margin-bottom:20px; color:var(--dark);">Login to Account</h2>

                    <div class="input-group hidden" id="nameGroup">
                        <input type="text" id="fullName" class="custom-input" placeholder="Full Name">
                        <i class="fas fa-user" style="position: absolute; right: 10px; top: 12px; color: var(--gray);"></i>
                    </div>

                    <div class="half-input-container hidden" id="agePhoneRow">
                        <div class="input-group">
                            <input type="number" id="age" class="custom-input" placeholder="Age" min="10" max="100">
                            <i class="fas fa-birthday-cake" style="position: absolute; right: 10px; top: 12px; color: var(--gray);"></i>
                        </div>
                        <div class="input-group">
                            <input type="tel" id="phone" class="custom-input" placeholder="Phone Number">
                            <i class="fas fa-phone" style="position: absolute; right: 10px; top: 12px; color: var(--gray);"></i>
                        </div>
                    </div>

                    <div class="half-input-container hidden" id="locationRow">
                        <div class="input-group">
                            <input type="text" id="state" class="custom-input" placeholder="State">
                            <i class="fas fa-map-marker-alt" style="position: absolute; right: 10px; top: 12px; color: var(--gray);"></i>
                        </div>
                        <div class="input-group">
                            <input type="text" id="city" class="custom-input" placeholder="City">
                            <i class="fas fa-building" style="position: absolute; right: 10px; top: 12px; color: var(--gray);"></i>
                        </div>
                    </div>

                    <div class="input-group">
                        <input type="email" id="email" class="custom-input" placeholder="Email Address" required>
                        <i class="fas fa-envelope" style="position: absolute; right: 10px; top: 12px; color: var(--gray);"></i>
                    </div>

                    <div class="input-group" id="passGroup">
                        <input type="password" id="password" class="custom-input" placeholder="Password">
                        <i class="fas fa-lock" style="position: absolute; right: 10px; top: 12px; color: var(--gray);"></i>
                    </div>

                    <div class="input-group" id="roleGroup">
                        <select id="role" class="custom-input" style="cursor: pointer;">
                            <option value="Student">Student</option>
                            <option value="Admin">Admin</option>
                        </select>
                        <i class="fas fa-chevron-down" style="position: absolute; right: 10px; top: 12px; color: var(--gray);"></i>
                    </div>

                    <div id="forgotLinks" style="margin-bottom: 20px; text-align: right; font-size: 0.9rem;">
                        <span onclick="window.switchMode('reset')" style="color: var(--primary); cursor: pointer; font-weight: 600;">Forgot Password?</span>
                    </div>
                    
                    <div id="backToLoginLink" class="hidden" style="margin-bottom: 20px; text-align: center; font-size: 0.9rem;">
                        <span onclick="window.switchMode('login')" style="color: var(--gray); cursor: pointer; font-weight: 600;"><i class="fas fa-arrow-left"></i> Back to Login</span>
                    </div>

                    <button type="submit" class="btn btn-fill" id="submitBtn" style="width: 100%; justify-content: center;">
                        Access Dashboard
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script type="module">
        import { auth, db, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail, doc, setDoc, getDoc, serverTimestamp, getDocs, collection, query, orderBy } from './firebase-config.js';

        // --- SCROLL LOGIC ---
        window.addEventListener('scroll', () => {
            const btn = document.querySelector('.scroll-top');
            if(window.scrollY > 300) btn.classList.add('visible');
            else btn.classList.remove('visible');
        });

        // --- COURSE LOGIC ---
        async function loadCourses() {
            const grid = document.getElementById('courseGrid');
            const q = query(collection(db, "courses"), orderBy("createdAt", "desc"));
            
            try {
                const querySnapshot = await getDocs(q);
                grid.innerHTML = "";
                
                if (querySnapshot.empty) {
                    grid.innerHTML = "<p style='grid-column:1/-1; text-align:center;'>No courses found. Admin needs to add some!</p>";
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const course = doc.data();
                    const title = course.title || "Untitled Course";
                    const cat = course.category || "General";
                    
                    // --- FIX FOR THUMBNAILS ---
                    // Try to get videoId from playlist first, then direct videoId
                    let vidId = "";
                    if (course.playlist && course.playlist.length > 0) {
                        vidId = course.playlist[0].videoId;
                    } else if (course.videoId) {
                        vidId = course.videoId;
                    }
                    
                    const thumb = vidId ? `https://img.youtube.com/vi/${vidId}/hqdefault.jpg` : 'https://via.placeholder.com/300?text=No+Video';

                    const card = `
                        <div class="course-card" data-title="${title.toLowerCase()}" data-cat="${cat.toLowerCase()}">
                            <div class="thumb-container">
                                <img src="${thumb}" class="course-img" onerror="this.src='https://via.placeholder.com/300'">
                            </div>
                            <div class="course-content">
                                <span class="course-tag">${cat}</span>
                                <h3 class="course-title">${title}</h3>
                                <p class="course-desc">Instructor: ${course.instructor}</p>
                                <button onclick="window.startCourse('${vidId}')" class="btn-outline" style="width:100%; justify-content:center; border-radius:10px; padding: 10px;">
                                    <i class="fas fa-play-circle"></i> Watch Now
                                </button>
                            </div>
                        </div>
                    `;
                    grid.innerHTML += card;
                });
            } catch (error) {
                console.error("Error loading courses:", error);
                grid.innerHTML = "<p>Error loading courses. Please check console.</p>";
            }
        }

        // TEXT SEARCH
        window.filterCourses = () => {
            const input = document.getElementById('searchInput').value.toLowerCase();
            const cards = document.querySelectorAll('.course-card');
            cards.forEach(card => {
                const title = card.getAttribute('data-title');
                const cat = card.getAttribute('data-cat');
                if (title.includes(input) || cat.includes(input)) card.style.display = "flex";
                else card.style.display = "none";
            });
        };

        // CATEGORY PILL FILTER
        window.filterCategory = (category, btnElement) => {
            document.querySelectorAll('.cat-pill').forEach(b => b.classList.remove('active'));
            btnElement.classList.add('active');

            const cards = document.querySelectorAll('.course-card');
            cards.forEach(card => {
                const cat = card.getAttribute('data-cat');
                if (category === 'all' || cat.includes(category)) card.style.display = "flex";
                else card.style.display = "none";
            });
        };

        window.startCourse = (videoId) => {
            if (auth.currentUser) window.location.href = "student.html"; 
            else {
                alert("Please Login to enroll in this course!");
                window.openModal('login');
            }
        };

        loadCourses();


        // --- AUTH LOGIC ---
        let currentMode = 'login'; 

        window.openModal = (mode) => {
            document.getElementById('authModal').classList.add('active');
            window.switchMode(mode);
        };

        window.closeModal = () => {
            document.getElementById('authModal').classList.remove('active');
        };

        window.toggleMenu = () => {
            const nav = document.getElementById('navLinks');
            nav.style.display = nav.style.display === 'flex' ? 'none' : 'flex';
        };

        window.switchMode = (mode) => {
            currentMode = mode;
            const btns = document.querySelectorAll('.toggle-btn');
            const nameGroup = document.getElementById('nameGroup');
            const agePhoneRow = document.getElementById('agePhoneRow');
            const locationRow = document.getElementById('locationRow');
            const passGroup = document.getElementById('passGroup');
            const roleGroup = document.getElementById('roleGroup');
            const forgotLinks = document.getElementById('forgotLinks');
            const backToLoginLink = document.getElementById('backToLoginLink');
            const title = document.getElementById('formTitle');
            const btn = document.getElementById('submitBtn');
            const form = document.getElementById('authForm');
            const passwordInput = document.getElementById('password');

            form.classList.remove('fade-in');
            void form.offsetWidth;
            form.classList.add('fade-in');

            if(mode === 'login') {
                btns[0].classList.add('active'); btns[1].classList.remove('active');
                nameGroup.classList.add('hidden');
                agePhoneRow.classList.add('hidden');
                locationRow.classList.add('hidden');
                passGroup.classList.remove('hidden');
                roleGroup.classList.remove('hidden');
                forgotLinks.classList.remove('hidden');
                backToLoginLink.classList.add('hidden');
                document.getElementById('fullName').required = false;
                document.getElementById('age').required = false;
                document.getElementById('phone').required = false;
                document.getElementById('state').required = false;
                document.getElementById('city').required = false;
                passwordInput.required = true;
                title.innerText = "Login to Account";
                btn.innerHTML = 'Access Dashboard';
            } 
            else if(mode === 'signup') {
                btns[0].classList.remove('active'); btns[1].classList.add('active');
                nameGroup.classList.remove('hidden');
                agePhoneRow.classList.remove('hidden');
                locationRow.classList.remove('hidden');
                passGroup.classList.remove('hidden');
                roleGroup.classList.remove('hidden');
                forgotLinks.classList.add('hidden');
                backToLoginLink.classList.add('hidden');
                document.getElementById('fullName').required = true;
                document.getElementById('age').required = true;
                document.getElementById('phone').required = true;
                document.getElementById('state').required = true;
                document.getElementById('city').required = true;
                passwordInput.required = true;
                title.innerText = "Create Free Account";
                btn.innerHTML = 'Create Account';
            }
            else if(mode === 'reset') {
                btns[0].classList.remove('active'); btns[1].classList.remove('active');
                nameGroup.classList.add('hidden');
                agePhoneRow.classList.add('hidden');
                locationRow.classList.add('hidden');
                passGroup.classList.add('hidden');
                roleGroup.classList.add('hidden');
                forgotLinks.classList.add('hidden');
                backToLoginLink.classList.remove('hidden');
                document.getElementById('fullName').required = false;
                passwordInput.required = false;
                title.innerText = "Reset Password";
                btn.innerHTML = 'Send Reset Link';
            }
        };

        window.handleAuth = async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;
            const btn = document.getElementById('submitBtn');

            btn.disabled = true;
            const originalText = btn.innerHTML;
            btn.innerHTML = 'Processing...';

            try {
                if(currentMode === 'reset') {
                    await sendPasswordResetEmail(auth, email);
                    alert("Reset link sent! Check your email.");
                    window.switchMode('login');
                }
                else if(currentMode === 'signup') {
                    const name = document.getElementById('fullName').value;
                    const phone = document.getElementById('phone').value;
                    const age = document.getElementById('age').value;
                    const state = document.getElementById('state').value;
                    const city = document.getElementById('city').value;

                    const userCred = await createUserWithEmailAndPassword(auth, email, password);
                    
                    await setDoc(doc(db, "users", userCred.user.uid), {
                        name: name, email: email, role: role,
                        phone: phone, age: age, state: state, city: city,
                        createdAt: serverTimestamp(), lastActive: serverTimestamp()
                    });

                    alert("Account Created Successfully!");
                    window.location.href = role === 'Admin' ? 'admin.html' : 'student.html';
                } 
                else {
                    const userCred = await signInWithEmailAndPassword(auth, email, password);
                    const docSnap = await getDoc(doc(db, "users", userCred.user.uid));
                    if(docSnap.exists()) {
                        const data = docSnap.data();
                        if(data.role !== role) throw new Error(`Role Mismatch: This account is a ${data.role}.`);
                        await setDoc(doc(db, "users", userCred.user.uid), { lastActive: serverTimestamp() }, { merge: true });
                        window.location.href = role === 'Admin' ? 'admin.html' : 'student.html';
                    } else {
                        throw new Error("User profile not found.");
                    }
                }
            } catch (error) {
                console.error(error);
                let msg = error.message;
                if(msg.includes('auth/user-not-found')) msg = "No account found with this email.";
                if(msg.includes('auth/wrong-password')) msg = "Incorrect password.";
                if(msg.includes('auth/email-already-in-use')) msg = "Email already registered.";
                alert(msg);
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }
    </script>
</body>
</html>